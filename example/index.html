<!DOCTYPE html>
<script src="./stbvorbis.js"></script>
<script>
var context = null;

async function initialize() {
  const buf = await (await fetch('./ragtime.ogg')).arrayBuffer();
  const result = await stbvorbis.decode(buf);
  const channels = result.data.length;
  console.log('channels:', channels);
  console.log('length:', result.data[0].length);
  console.log('sampleRate:', result.sampleRate);

  var AudioContext = window.AudioContext || window.webkitAudioContext;
  context = new AudioContext();
  const buffer = context.createBuffer(result.data.length, result.data[0].length, result.sampleRate);
  for (let i = 0; i < channels; i++) {
    // copyToChannel might not be available on Safari.
    if (buffer.copyToChannel) {
      buffer.copyToChannel(result.data[i], i);
    } else {
      buffer.getChannelData(i).set(result.data[i]);
    }
  }
  const source = context.createBufferSource();
  source.buffer = buffer;
  source.connect(context.destination);
  source.start(0);

  button.disabled = false;
}

window.addEventListener('DOMContentLoaded', async () => {
  await initialize()
  document.getElementById('button').addEventListener('click', () => {
    const button = document.getElementById('button');
    switch (button.innerText) {
    case 'Resume':
      context.resume();
      button.innerText = 'Suspend';
      break;
    case 'Suspend':
      context.suspend();
      button.innerText = 'Resume';
      break;
    }
  });
});
</script>
<button id="button" disabled>Suspend</button>
